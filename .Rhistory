">60 min.")) +
scale_fill_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_x_continuous(breaks=seq(2009, 2023, 1),
labels=c(seq(2009, 2021, 1), "", "2023")) +
scale_y_continuous(limits=c(0, .9),
labels=paste0(seq(0, 90, 10), "%"),
breaks=seq(0, .9, .1)) +
scale_shape_manual(values=c(21, 22, 23, 24),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
geom_text(aes(y=if_else(category == "min_60", conf_low - .02, conf_high + 0.015),
label=paste0(round(proportion , 2)*100, "%")),
size=2, color="black") +
geom_line() +
theme_avp() +
labs(x="Ano", y="Indivíduos",
color="Deslocamento", fill="Deslocamento", shape="Deslocamento") +
theme(axis.text.x = element_text(angle = 45, hjust=1))
)
(
grupos_9_11 <- ggplot(subset(perg2_props_main_esc,
escolaridade_cat_num == "9-11 anos"), aes(x=ano, y=proportion,
ymin=conf_low, ymax=conf_high,
color=category, fill=category)) +
facet_wrap(~escolaridade_cat_num) +
geom_vline(xintercept=2020, linetype="dashed", alpha=.5) +
geom_pointrange(aes(shape=category), size=0.25) +
scale_color_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_fill_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_x_continuous(breaks=seq(2009, 2023, 1),
labels=c(seq(2009, 2021, 1), "", "2023")) +
scale_y_continuous(limits=c(0, .9),
labels=paste0(seq(0, 90, 10), "%"),
breaks=seq(0, .9, .1)) +
scale_shape_manual(values=c(21, 22, 23, 24),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
geom_text(aes(y=if_else(category == "min_60", conf_low - .02, conf_high + 0.015),
label=paste0(round(proportion , 2)*100, "%")),
size=2, color="black") +
geom_line() +
theme_avp() +
labs(x="Ano", y="Indivíduos",
color="Deslocamento", fill="Deslocamento", shape="Deslocamento") +
theme(axis.text.x = element_text(angle = 45, hjust=1))
)
(
grupos_12 <- ggplot(subset(perg2_props_main_esc,
escolaridade_cat_num == "12 ou mais anos"), aes(x=ano, y=proportion,
ymin=conf_low, ymax=conf_high,
color=category, fill=category)) +
facet_wrap(~escolaridade_cat_num) +
geom_vline(xintercept=2020, linetype="dashed", alpha=.5) +
geom_pointrange(aes(shape=category), size=0.25) +
scale_color_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_fill_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_x_continuous(breaks=seq(2009, 2023, 1),
labels=c(seq(2009, 2021, 1), "", "2023")) +
scale_y_continuous(limits=c(0, .9),
labels=paste0(seq(0, 90, 10), "%"),
breaks=seq(0, .9, .1)) +
scale_shape_manual(values=c(21, 22, 23, 24),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
geom_text(aes(y=if_else(category == "min_60", conf_low - .02, conf_high + 0.015),
label=paste0(round(proportion , 2)*100, "%")),
size=2, color="black") +
geom_line() +
theme_avp() +
labs(x="Ano", y="Indivíduos",
color="Deslocamento", fill="Deslocamento", shape="Deslocamento") +
theme(axis.text.x = element_text(angle = 45, hjust=1))
)
((grupos_0_4 + grupos_5_8) / (grupos_9_11 + grupos_12)) +
plot_annotation(tag_levels = "A") +
plot_layout(guides="collect") &
theme(legend.position='bottom')
ggsave("figuras/plot_categorias_atividade_deslocamento_todos.png", dpi=600,
units="in", height=8, width=8)
ggsave("figuras/plot_categorias_atividade_deslocamento_todos.pdf", dpi=600,
units="in", height=8, width=8, useDingbats=FALSE)
View(perg2_props_main_esc)
m1 <- svyglm(ativamente_fisico_desloc_num ~ ano, family = quasibinomial(), design=vigi_design)
summary(m1)
m1_spline <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)), family = quasibinomial(), design=vigi_design)
summary(m1_spline)
car::Anova(m1_spline)
anova(m1, m1_spline)
AIC(m1, m1_spline)
AIC(m1, m1_spline)
546554.4 - 545781.9
perg1_props <- svyby(
formula = ~ativamente_fisico_desloc,
by = ~ano,
design = vigi_design,
FUN = svyciprop,
method = "logit",  # Logit transform for CI
vartype = "ci"     # Return confidence intervals
)
perg1_props <- perg1_props |> as_tibble() |>
mutate(macro_reg = "Geral")
perg1_trend <- ggpredict(m1, terms=c("ano [all]")) |> as_tibble()
perg1_props
mutate(estimate = paste0(ativamente_fisico_desloc, " (", ci_l, "; ", ci_u, ")")
perg1_props <- perg1_props |> as_tibble() |>
perg1_props <- perg1_props |> as_tibble() |>
mutate(macro_reg = "Geral") |>
mutate(estimate = paste0(ativamente_fisico_desloc, " (", ci_l, "; ", ci_u, ")"))
View(perg1_props)
perg1_props <- perg1_props |> as_tibble() |>
mutate(macro_reg = "Geral") |>
mutate(estimate = paste0(round(ativamente_fisico_desloc, 3), " (", round(ci_l, 3), "; ",
round(ci_u,3 ), ")"))
perg1_props
writexl::write_xlsx(perg1_props, "proporcoes_e_IC_ativos_fisicamente_desloc.xlsx")
m2_1_spline <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) * macro_reg, family = quasibinomial(), design=vigi_design)
car::Anova(m2_1_spline, type="II")
perg1_regioes_props <- svyby(
formula = ~ativamente_fisico_desloc,
by = ~ano + macro_reg,
design = vigi_design,
FUN = svyciprop,
method = "logit",  # Logit transform for CI
vartype = "ci"     # Return confidence intervals
)
perg1_regioes_trend
perg1_regioes_props
perg1_regioes_props <- perg1_regioes_props |> as_tibble() |>
mutate(estimate = paste0(round(ativamente_fisico_desloc, 3), " (", round(ci_l, 3), "; ",
round(ci_u,3 ), ")"))
perg1_regioes_props
writexl::write_xlsx(perg1_regioes_props, "MACROREG_proporcoes_e_IC_ativos_fisicamente_desloc.xlsx")
View(perg1_regioes_props)
ggpredict(m2_1_spline, terms=c('ano [all]', 'macro_reg')) |> plot()
m2_1_spline_pred <- predict(m2_1_spline, type="response") |>
as_tibble() |>
mutate(ano = vigi_design$variables$ano,
macro_reg = vigi_design$variables$macro_reg,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, macro_reg) |> slice(1) |>
ungroup()
m2_1_spline_pred
ggplot(m2_1_spline_pred, aes(x=ano, y=response, ymin=conf.low,
ymax=conf.high, color=macro_reg)) +
geom_pointrange() +
geom_line()
m3_prop_piecewise_esc <- svyolr(cat_ativ ~ bs(ano_2, knots = c(2.020, 2.021), degree=1) *
escolaridade_cat_num, design=vigi_design)
model_desloc_faixa2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
faixa_etaria, family = quasibinomial(), design=vigi_design)
ggpredict(model_desloc_faixa2, c("ano", "faixa_etaria")) |> plot()
model_esc2_sp_pred <- predict(model_esc2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$escolaridade_cat_num,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, escolaridade_cat_num) |> slice(1) |>
ungroup()
model_esc2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
escolaridade_cat_num, family = quasibinomial(), design=vigi_design_esc)
model_esc2_sp_pred <- predict(model_esc2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$escolaridade_cat_num,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, escolaridade_cat_num) |> slice(1) |>
ungroup()
model_esc2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
escolaridade_cat_num, family = quasibinomial(), design=vigi_design_esc)
vigi_design_esc <- subset(vigi_design, !is.na(escolaridade_cat_num))
model_esc2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
escolaridade_cat_num, family = quasibinomial(), design=vigi_design_esc)
model_esc2_sp_pred <- predict(model_esc2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$escolaridade_cat_num,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, escolaridade_cat_num) |> slice(1) |>
ungroup()
ggplot(model_esc2_sp_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=escolaridade_cat_num,
fill=escolaridade_cat_num)) +
geom_line() +
geom_ribbon(alpha=.25)
model_desloc_faixa2_pred <- predict(model_desloc_faixa2, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
model_desloc_faixa2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
faixa_etaria, family = quasibinomial(), design=vigi_design)
model_desloc_faixa2_pred <- predict(model_desloc_faixa2, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
model_desloc_faixa2_pred <- predict(model_desloc_faixa2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
ggplot(model_desloc_faixa2_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=escolaridade_cat_num,
fill=faixa_etaria)) +
geom_line() +
geom_ribbon(alpha=.25)
vigi_design_faixa <- subset(vigi_design, !is.na(faixa_etaria))
model_desloc_faixa2_sp <- svyglm(ativamente_fisico_desloc_num ~ ns(ano, knots=c(2015, 2020, 2021)) *
faixa_etaria, family = quasibinomial(), design=vigi_design_faixa)
model_desloc_faixa2_pred <- predict(model_desloc_faixa2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_esc$variables$ano,
escolaridade_cat_num = vigi_design_esc$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
model_desloc_faixa2_pred <- predict(model_desloc_faixa2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_faixa$variables$ano,
escolaridade_cat_num = vigi_design_faixa$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
model_desloc_faixa2_pred
predict(model_desloc_faixa2_sp, type="response") |>
as_tibble()
vigi_design_faixa$variables$faixa_etaria
predict(model_desloc_faixa2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_faixa$variables$ano,
escolaridade_cat_num = vigi_design_faixa$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96))
model_desloc_faixa2_pred <- predict(model_desloc_faixa2_sp, type="response") |>
as_tibble() |>
mutate(ano = vigi_design_faixa$variables$ano,
faixa_etaria = vigi_design_faixa$variables$faixa_etaria,
conf.low = response - (SE * 1.96),
conf.high = response + (SE * 1.96)) |> group_by(ano, faixa_etaria) |> slice(1) |>
ungroup()
ggplot(model_desloc_faixa2_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=escolaridade_cat_num,
fill=faixa_etaria)) +
geom_line() +
geom_ribbon(alpha=.25)
model_desloc_faixa2_pred
ggplot(model_desloc_faixa2_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=escolaridade_cat_num,
fill=faixa_etaria)) +
geom_line() +
geom_ribbon(alpha=.25)
ggplot(model_desloc_faixa2_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=faixa_etaria,
fill=faixa_etaria)) +
geom_line() +
geom_ribbon(alpha=.25)
ggplot(model_esc2_sp_pred, aes(x=ano, y=response, ymin=conf.low, ymax=conf.high, color=escolaridade_cat_num,
fill=escolaridade_cat_num)) +
geom_line() +
geom_ribbon(alpha=.25)
library(tidyverse); library(survey); library(ggeffects); library(svyVGAM);
library(patchwork); library(gtsummary); library(prais)
# themes
theme_avp <- function() {
theme_classic(base_size=10) +
theme(axis.title.x = element_text(size = 9),
axis.title.y = element_text(size = 9),
panel.grid.minor = element_blank(),
panel.grid.major.x = element_line(),
panel.grid.major.y = element_line())
}
theme_sharp2 <- function() {
theme_classic(base_size = 12) +
theme(panel.grid.major.x = element_line(),
plot.tag = element_text(face="bold"),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
axis.line.y = element_blank())
}
load("banco_reduzido.Rdata")
vigitel <- vigitel |>
mutate(q9 = if_else(q9 %in% c(777, 888), NA_real_, q9),
q11 = if_else(q11 %in% c(777, 888), NA_real_, q11),
escolaridade_cat_custom = case_when(q8a %in% c(1, 2, 3, 8) ~ "Não completou 1º grau",
q8a == 4 ~ "1º grau ou equivalente completo",
q8a == 5 ~ "2º ou equivalente completo",
q8a %in% c(6, 7) ~ "3º grau completo e/ou pós-graduação",
q8a %in% c(777, 888) ~ NA_character_),
escolaridade_cat_num = case_when(q8_anos <= 4 ~ "0-4 anos",
q8_anos >= 5 & q8_anos <=8 ~ "5-8 anos",
q8_anos >= 9 & q8_anos <=11 ~ "9-11 anos",
q8_anos >= 12 ~ "12 ou mais anos",
q8_anos %in% c(777, 888) ~ NA_character_),
escolaridade_cat_num2 = case_when(q8_anos < 1 ~ "0",
q8_anos >= 1 & q8_anos <=4 ~ "1-4 anos",
q8_anos >= 5 & q8_anos <=8 ~ "5-8 anos",
q8_anos >= 9 & q8_anos <=11 ~ "9-11 anos",
q8_anos >= 12 ~ "12 ou mais anos",
q8_anos %in% c(777, 888) ~ NA_character_),
trajeto_trabalho = case_when(q47 == 2 ~ "não",
q50 %in% c(1, 2) ~ "sim",
q50 == 3 ~ "não"),
duracao_trajeto_trabalho = case_when(trajeto_trabalho == "não" ~ 0,
TRUE ~ q51),
trajeto_curso = case_when(q52 == 888 ~ "não",
q52 == 2 ~ "não",
q53 == 3 ~ "não",
q53 %in% c(1, 2) ~ "sim"),
duracao_trajeto_curso = case_when(trajeto_curso == "não" ~ 0,
TRUE ~ q54),
soma_ambos_trajetos = duracao_trajeto_trabalho + duracao_trajeto_curso,
ativamente_fisico_desloc = if_else(soma_ambos_trajetos >= 4, "sim", "não"),
ativamente_fisico_desloc_num = if_else(soma_ambos_trajetos >= 4, 1, 0),
ativamente_fisico_desloc_novo = case_when(
duracao_trajeto_trabalho == 0 & duracao_trajeto_curso >= 4 ~ "sim",
duracao_trajeto_trabalho == 0 & duracao_trajeto_curso < 4 ~ "não",
duracao_trajeto_trabalho == 1 & duracao_trajeto_curso >= 3 ~ "sim", # polemico?
duracao_trajeto_trabalho == 1 & duracao_trajeto_curso < 3 ~ "não",
duracao_trajeto_trabalho == 2 & duracao_trajeto_curso >= 2 ~ "sim",
duracao_trajeto_trabalho == 2 & duracao_trajeto_curso < 2 ~ "não",
duracao_trajeto_trabalho == 3 & duracao_trajeto_curso >= 1 ~ "sim",
duracao_trajeto_trabalho == 3 & duracao_trajeto_curso < 1 ~ "não",
##
duracao_trajeto_curso == 0 & duracao_trajeto_trabalho >= 4 ~ "sim",
duracao_trajeto_curso == 0 & duracao_trajeto_trabalho < 4 ~ "não",
duracao_trajeto_curso == 1 & duracao_trajeto_trabalho >= 3 ~ "sim", # polemico?
duracao_trajeto_curso == 1 & duracao_trajeto_trabalho < 3 ~ "não",
duracao_trajeto_curso == 2 & duracao_trajeto_trabalho >= 2 ~ "sim",
duracao_trajeto_curso == 2 & duracao_trajeto_trabalho < 2 ~ "não",
duracao_trajeto_curso == 3 & duracao_trajeto_trabalho >= 1 ~ "sim",
duracao_trajeto_curso == 3 & duracao_trajeto_trabalho < 1 ~ "não",
##
duracao_trajeto_trabalho >= 4 ~ "sim",
duracao_trajeto_curso >= 4 ~ "sim"),
cat_ativ = case_when(soma_ambos_trajetos == 0 ~ "Não realiza",
soma_ambos_trajetos > 0 & soma_ambos_trajetos < 4 ~ ">0 e ≤30 minutos",
soma_ambos_trajetos >= 4 & soma_ambos_trajetos < 7 ~ ">30 e ≤60 minutos",
soma_ambos_trajetos >= 7 ~ ">60 minutos"),
macro_reg = case_when(
cidade %in% c(1, 9, 11, 13, 15, 19, 22, 23, 25) ~ "Nordeste",
cidade %in% c(2, 3, 4, 12, 14, 16, 18, 20) ~ "Norte",
cidade %in% c(3, 21, 24, 26) ~ "Sudeste",
cidade %in% c(27, 5, 6, 10) ~ "Centro-Oeste",
cidade %in% c(8, 17, 7) ~ "Sul"),
cat_ativ = ordered(cat_ativ,
levels = c("Não realiza",
">0 e ≤30 minutos",
">30 e ≤60 minutos",
">60 minutos"))) |>
rename(ano = ano, idade = q6, sexo = q7, faixa_etaria = fet,
grau_escolar = q8a, peso_kg = q9, altura_cm = q11, faz_exercicio = q42,
trabalha = q47, anda_a_pe = q48, carrega_peso = q49, faz_trajeto_a_pe = q50,
faz_curso_escola = q52, fumante = q60, ex_fumante = q64, cor = q69,
estado_saude = q74, pressao_alta = q75, diabetes = q76, colesterol_trig = q78,
posse_plano = q88) |>
mutate(across(c(faixa_etaria, escolaridade_cat_custom, escolaridade_cat_num, escolaridade_cat_num2,
grau_escolar, faz_exercicio, trabalha,
anda_a_pe, carrega_peso, faz_trajeto_a_pe, faz_curso_escola,
fumante, ex_fumante, cor, estado_saude, pressao_alta, diabetes,
colesterol_trig, posse_plano), as.factor))
vigitel |> group_by(escolaridade_cat_num) |> count()
vigitel |> group_by(escolaridade_cat_num2) |> count()
vigi_table <- vigitel |> select(ano, peso_kg, altura_cm, faixa_etaria, sexo, cor,
escolaridade_cat_num, macro_reg, trabalha,
faz_exercicio, carrega_peso, anda_a_pe, faz_trajeto_a_pe,
faz_curso_escola, fumante, pressao_alta, diabetes, colesterol_trig, pesorake,
ativamente_fisico_desloc_num, soma_ambos_trajetos)
vigi_design <- svydesign(id = ~ 1,
strata = NULL,
weights= ~ pesorake,
data=vigitel)
vigi_table_design <- svydesign(id = ~ 1,
strata = NULL,
weights= ~ pesorake,
data=vigi_table)
vigi_design <- subset(vigi_design, !is.na(ativamente_fisico_desloc_num))
vigi_design <- subset(vigi_design, !is.na(soma_ambos_trajetos))
vigi_table_design <- subset(vigi_table_design, !is.na(ativamente_fisico_desloc_num))
vigi_table_design <- subset(vigi_table_design, !is.na(soma_ambos_trajetos))
vigi_design <- update(vigi_design, ano_2 = ano/1000)
m3_prop <- svyolr(cat_ativ ~ ano_2, design=vigi_design)
m3_prop_piecewise <- svyolr(cat_ativ ~ bs(ano_2, knots = c(2.020, 2.021), degree=1), design=vigi_design)
car::Anova(m3_prop_piecewise, type="II")
AIC(m3_prop, m3_prop_piecewise)
car::Anova(m3_prop_piecewise, type="II")
perg2_props <- svyby(
formula = ~cat_ativ,
by = ~ano,
design = vigi_design,
FUN = svymean,
method = "logit",  # Logit transform for CI
vartype = "ci"     # Return confidence intervals
)
names(perg2_props) <- c("ano", "nao_realiza", "min_0_30", "min_30_60", "min_60",
"nao_realiza_conf_low", "min_0_30_conf_low", "min_30_60_conf_low", "min_60_conf_low",
"nao_realiza_conf_high", "min_0_30_conf_high", "min_30_60_conf_high", "min_60_conf_high")
perg2_props_main <- perg2_props |>
pivot_longer(
cols = starts_with("nao_realiza") | starts_with("min_"),
names_to = "category",
values_to = "proportion",
names_pattern = "^(.*)$"  # Match all column names
) |>
filter(!stringr::str_detect(category, "conf_low|conf_high"))
perg2_props_low <- perg2_props |>
pivot_longer(
cols = starts_with("nao_realiza") | starts_with("min_"),
names_to = "category",
values_to = "proportion",
names_pattern = "^(.*)$"  # Match all column names
) |>
filter(stringr::str_detect(category, "conf_low")) |>
rename(conf_low = proportion)
perg2_props_high <- perg2_props |>
pivot_longer(
cols = starts_with("nao_realiza") | starts_with("min_"),
names_to = "category",
values_to = "proportion",
names_pattern = "^(.*)$"  # Match all column names
) |>
filter(stringr::str_detect(category, "conf_high")) |>
rename(conf_high = proportion)
perg2_props_main$conf_low <- perg2_props_low$conf_low
perg2_props_main$conf_high <- perg2_props_high$conf_high
perg2_props_main <- perg2_props_main |>
mutate(category = fct_relevel(category,
"nao_realiza",
"min_0_30",
"min_30_60",
"min_60")) |>
mutate(escolaridade_cat_num = "Geral")
(
grupos_geral <- ggplot(perg2_props_main, aes(x=ano, y=proportion, ymin=conf_low, ymax=conf_high,
color=category, fill=category)) +
facet_wrap(~escolaridade_cat_num) +
geom_vline(xintercept=2020, linetype="dashed", alpha=.5) +
geom_pointrange(aes(shape=category), size=0.25) +
scale_color_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_fill_manual(values=c("#3db85a", "#1f9075", "#2a487a", "#361865"),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
scale_x_continuous(breaks=seq(2009, 2023, 1),
labels=c(seq(2009, 2021, 1), "", "2023")) +
scale_y_continuous(limits=c(0, .9),
labels=paste0(seq(0, 90, 10), "%"),
breaks=seq(0, .9, .1)) +
scale_shape_manual(values=c(21, 22, 23, 24),
labels=c("Não realiza",
">0 e ≤30 min.",
">30 e ≤60 min.",
">60 min.")) +
geom_text(aes(y=if_else(category == "min_60", conf_low - .02, conf_high + 0.015),
label=paste0(round(proportion , 2)*100, "%")),
size=2.5, color="black") +
geom_line() +
theme_avp() +
labs(x="Ano", y="Indivíduos",
color="Deslocamento", fill="Deslocamento", shape="Deslocamento") +
theme(axis.text.x = element_text(angle = 45, hjust=1))
)
perg2_props_main
perg2_props_main |>
mutate(estimate = paste0(round(ativamente_fisico_desloc, 3), " (",
round(ci_l, 3), "; ",
round(ci_u,3 ), ")"))
perg2_props_main
perg2_props_main |>
mutate(estimate = paste0(round(proportion , 3), " (",
round(conf_low, 3), "; ",
round(conf_high,3 ), ")"))
perg2_props_main |>
mutate(estimate = paste0(round(proportion , 3), " (",
round(conf_low, 3), "; ",
round(conf_high,3 ), ")")) |>
writexl::write_xlsx("grupos_desloc_tendencia_anual.xlsx")
perg2_props_main |>
mutate(estimate = paste0(round(proportion , 3), " (",
round(conf_low, 3), "; ",
round(conf_high,3 ), ")")) |> View()
